<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <title>Visualization</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript" src="network.js"></script>
  <script type="text/javascript" src="net.js"></script>

  <style>
    #x {
      position: relative;
    }

    #mynetwork {
      position: absolute;
    }
  </style>
</head>

<body>
  <div id="main"> Visualization </div>
  <div class="wrapper">
    <div id="x" class="item0">
      <div id="mynetwork" align="center"></div>
    </div>
    <div class="item1">
      <button onclick="Camera_clicked('http://192.168.0.111:9000')">button</button>
      <iframe id="video" src="http://192.168.0.111:8080/bb4679beceeed4c703b88a7c0ec40b24/embed/2Df5hBE/hnwMvM8Thr/jquery|fullscreen" width="100%" height="100%"></iframe>
    </div>
    <div align="center"></div>
    <div class="item2">패널2</div>
    <div class="item3">
      <!-- <div align="center"> -->
      <button style="WIDTH: 80px; HEIGHT: 40px" onclick="changePanel(this)" value="2">Temp</button>
      <button style="WIDTH: 80px; HEIGHT: 40px" onclick="changePanel(this)" value="4">Light</button>
      <button style="WIDTH: 80px; HEIGHT: 40px" onclick="changePanel(this)" value="6">Cogas</button>
      <button style="WIDTH: 80px; HEIGHT: 40px" onclick="changePanel(this)" value="8">Alchol</button> <!-- AlcholGas 8, CoGas 6, Light 4, Temperature 2-->
      <iframe id="grafanabutton" src="http://192.168.0.111:9000/d-solo/zH6txHIWz/iot?orgId=1&from=now-5m&to=now&refresh=10s&fullscreen&panelId=2" width="100%" height="100%"></iframe>
      <!-- </div> -->
    </div>
    <div class="item4">
    </div>

    <script>
      function changePanel(a) { // 그라파나 패널 센서별 변경
        var grafanasrc = "http://192.168.0.111:9000/d-solo/zH6txHIWz/iot?orgId=1&from=now-5m&to=now&refresh=10s&fullscreen&panelId="
        var tempsrc = grafanasrc + a.value
        $("#grafanabutton").attr('src', tempsrc)
      }

      function Camera_clicked(url) { // 카메라 URL 변경
        $('#video').attr('src', url);
      }
      var imgname = "";

      function f2(e) { //How to get NodeName-value
        imgname = e.alt
      }
      $(document).on('mouseover', "#left1", function() {
        $.contextMenu({
          selector: '#left1',
          trigger: 'left',
          callback: function(key, options) { //지역 생성
            if (key == "create") {
              var myWindow = window.open("open1.html", "myWindow", "width=620,height=160,top=50"); //지역생성팝업창.
            } else if (key == "delete") { //지역 삭제
              var text = prompt("지역 이름을 입력하시오 : ", "ex)JNU");
              if (text == null) {
                alert("취소하셨습니다.");
              } else {
                var r = confirm("정말로 삭제하시겠습니까 ? ");
              }
              if (r == true) {
                $.post("http://192.168.0.111:3000/deleteNode/", {
                  "NodeName": text
                }, function(data, status) {
                  if (data.success == 1) {
                    alert(text + " 지역이(가) 제거되었습니다.");
                    window.location.reload();
                  } else {
                    alert(text + " 지역이(가) 목록에 없습니다.");
                  }
                })
              } else {
                alert("취소 버튼을 누르셨습니다.");
              }
            }
          },
          items: {
            "create": {
              name: "지역 추가",
              icon: "edit"
            }
          }
        });
      });
      $(document).on('mouseover', "#left2", function() {
        $.contextMenu({
          selector: '#left2',
          trigger: 'left',
          callback: function(key, options) { //지역 생성
            if (key == "delete") { //지역 삭제
              var text = prompt("지역 이름을 입력하시오 : ", "ex)JNU");
              if (text == null) {
                alert("취소하셨습니다.");
              } else {
                var r = confirm("정말로 삭제하시겠습니까 ? ");
              }

              if (r == true) {
                $.post("http://192.168.0.111:3000/deleteNode/", {
                  "NodeName": text
                }, function(data, status) {
                  if (data.success == 1) {
                    alert(text + " 지역이(가) 제거되었습니다.");
                    window.location.reload();
                  } else {
                    alert(text + " 지역 삭제 실패 ");
                  }
                })
              }
            }
          },
          items: {
            "fold1": {
              "name": "센서 추가",
              icon: "edit",
              "items": {
                "Mosquitto": {
                  "name": "Mosquitto",
                  callback: function(itemKey, opt, e) {
                    $.post("http://192.168.0.111:3000/createSensor/", {
                      "id": "25", //프론트엔드 네이밍
                      "Dtype": itemKey,
                      "NodeName": imgname,
                      "Topic": "Love" //모스키토에서 컨테이너 생성시 사용
                    }, function(data, status) {
                      if (data.result == 1) {
                        alert("Dtype : " + itemKey + "  NodeName : " + imgname + "\n센서생성");
                        window.location.reload();
                      } else {
                        alert("센서생성 실패입니다.");
                      }
                    })
                  }
                },
                /*  callback: function(itemKey, opt, e) {
                    m = itemKey;
                    window.console && console.log(imgname) || alert(m);
                  }
                },
                   "id": "25",
                  "Dtype": itemKey,
                  "NodeName":imgname,
                  "Topic":"Love"
                  */
                "Kafka": {
                  "name": "Kafka",
                  callback: function(itemKey, opt, e) {
                    m = itemKey;
                    window.console && console.log(m) || alert(m);
                  }
                },
                "Camera": {
                  "name": "Camera",
                  "items": {
                    "fold2-key1": {
                      name: "URL",
                      type: 'text'
                    },
                    sep1: "--------",
                    select: {
                      name: "Select",
                      type: 'select',
                      options: {
                        1: 'RTSP',
                        2: "RTMP"
                      }
                    },
                    sep2: "--------",
                    camera: {
                      name: "추가",
                      callback: function(itemKey, opt, e) {
                        m = itemKey;
                        window.console && console.log(m) || alert(m);
                      }
                    }
                  }
                }
              }
            },
            "delete": {
              name: "지역 삭제",
              icon: "delete"
            }
          }
        });
      });
      $(document).on('mouseover', "#left3", function() {
        $.contextMenu({
          selector: '#left3',
          trigger: 'left',
          callback: function(key, options) { //센서 삭제
            $.post("http://192.168.0.111:3000/deleteSensor/", {
              "id": "25",
              "Dtype": itemKey,
              "NodeName": imgname,
              "Topic": "Love"
            }, function(data, status) {
              if (data.result == 1) {
                alert("Dtype : " + itemKey + "  NodeName : " + imgname + "\n센서생성");
                window.location.reload();
              } else {
                alert("센서생성 실패입니다.");
              }
            })
          },
          items: {
            "delete": {
              name: "센서 삭제",
              icon: "delete"
            }
          }
        });
      });
    </script>
</body>

</html>
